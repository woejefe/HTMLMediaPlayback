<!DOCTYPE html>

<html>
 <head>
        <title>Audio Playback</title>
		
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">	
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.13.0/Sortable.min.js"></script>
		
		
 </head>
<style>

row {
  list-style: none;
  padding: 0;
  margin: 0;
}

row:nth-child(even) {
  background-color: lightblue;
}

row:nth-child(odd) {
  background-color: lightgray;
}
 li {display: block;}

		
</style> 

<body style="background:gray;">	        
		<a class="card text-center" href="https://freemp3cloud.com/" target="_blank" rel="noopener noreferrer">Download MP3's Here</a>
		 
		<div class="card text-center" style="border: 2px solid green;padding:5px;background:lightgray;"> Upload Audio Files(m4a,ogg,mp3,wav)		  
		  <div class="container"> 		 
		    <input class="card text-center" name="mediaFiles" id="mediaFiles" type="file" multiple style="border: 2px solid blue;padding:10px;background:teal;" accept="audio/mpeg,audio/ogg,audio/wav,audio/mp4"> </input>
			<button id="recordButton">Record</button>
		  </div>		
		</div>							
			
			<h1 class="card text-center my-1" style="border: 2px solid green;padding:5px;background:lightblue;">Audio Playback</h1>
        	      
        <div class="card" style="background:lightgray;">
			<sblist class="row" id="sortableplaylist" >	
			
			</sblist>
		</div>
	</body>		
<script>
   
   new Sortable(sortableplaylist);
   let recordButton = document.getElementById('recordButton');
   let mediaRecorder = null;
   let chunks = [];

   recordButton.addEventListener('click', function() {
     if (mediaRecorder === null) {
       navigator.mediaDevices.getUserMedia({ audio: true })
         .then(function(stream) {
           mediaRecorder = new MediaRecorder(stream);
           mediaRecorder.addEventListener('dataavailable', function(event) {
             chunks.push(event.data);
           });
           mediaRecorder.addEventListener('stop', function() {
             var blob = new Blob(chunks, { type: 'audio/webm' });
             var url = URL.createObjectURL(blob);
             var audio = document.createElement('audio');
             audio.controls = true;
             audio.src = url;
             var row = document.createElement('row');
             row.appendChild(audio);
            
			 const trackcontainer=document.createElement('row');
  			 const playbtn = document.createElement('button');
			 const stopbtn = document.createElement('button');		
			 const loopbtn = document.createElement('button');
			 const btncontrol = document.createElement('div');
	         const cuecontrol = document.createElement('div');
			 const deletebtn = document.createElement('button');			 
	         const playerwindow = document.createElement('div');		
	         const mediaplayer = document.createElement('audio');
			 const recordTitle = document.createElement('input');
			 mediaplayer.setAttribute('data-setup', '{}');
			 mediaplayer.controls = true;
			 mediaplayer.setAttribute("src", url);
			 mediaplayer.load();
			 playbtn.addEventListener('click', function() {
         if (mediaplayer.paused || mediaplayer.ended) {
          mediaplayer.play();
          playbtn.textContent = 'Pause';
		  playbtn.style.background='yellow';}
        else {
          mediaplayer.pause();
          playbtn.textContent = 'Play';
		  playbtn.style.background='green';}	});
		
	    loopbtn.addEventListener("click",	() => {		     
	     if (mediaplayer.loop === true) {
		 mediaplayer.loop = false;
		 loopbtn.style.background='lightgray';}
	     else {mediaplayer.loop = true;
		 loopbtn.style.background='blue';}		});
		 
		 stopbtn.addEventListener("click",	() => {
		 mediaplayer.pause();
		 mediaplayer.load();
		 mediaplayer.loop = false;
		 loopbtn.style.background='lightgray';
		 playbtn.textContent = 'Play'		 
		 playbtn.style.background='green';
		 });

  const deletetrack =[document.getElementById('sortableplaylist')]
		deletebtn.addEventListener("click", () => {		
	    medialist.removeChild(trackcontainer);	});
		medialist.appendChild(trackcontainer);
		cuecontrol.appendChild(recordTitle);
		trackcontainer.appendChild(cuecontrol);
		trackcontainer.appendChild(playerwindow);
		playerwindow.appendChild(mediaplayer);
		trackcontainer.appendChild(btncontrol);	
	
	
	
		btncontrol.appendChild(loopbtn);	
		btncontrol.appendChild(playbtn);
		btncontrol.appendChild(stopbtn);	
		btncontrol.appendChild(deletebtn);
	
		trackcontainer.className="row";
		
	    trackcontainer.style.border="2px solid purple";
	    trackcontainer.style.height="10%";
		
		
		cuecontrol.className="col";
		playerwindow.className="col";
		btncontrol.className="col";
		
		cuecontrol.style.width="33%";
		playerwindow.style.width="33%";
		btncontrol.style.width="33%";
		
		
		stopbtn.innerHTML="STOP";
		loopbtn.innerHTML="Loop";
		playbtn.textContent = 'Play';
		
		deletebtn.innerHTML="Delete";
		
		loopbtn.style.background="lightgray";
		
		playbtn.style.background="green";
		stopbtn.style.background="orange";
		deletebtn.style.background="red";
	
		loopbtn.id="loopbtn";
             chunks = [];
           });
           mediaRecorder.start();
           recordButton.textContent = 'Stop';
         })
         .catch(function(error) {
           console.error('Error accessing microphone:', error);
         });
     } else {
       mediaRecorder.stop();
       mediaRecorder = null;
       recordButton.textContent = 'Record';
     }
   });
   
	const medialist = document.getElementById('sortableplaylist');
	mediaFiles.addEventListener('change', function() {
           for (let i = 0; i < this.files.length; i++){  
				   
   	
	const file = this.files[i];
    const url = URL.createObjectURL(file);
			
	const listItem = document.createElement("li");
	const sourceItem = document.createElement("source");
	const cuebtn = document.createElement('button');
	const deletebtn = document.createElement('button');	
	const playbtn = document.createElement('button');
	const stopbtn = document.createElement('button');		
	const loopbtn = document.createElement('button');
	loopbtn.id="loopbtn";
	 
 
	
	const trackcontainer=document.createElement('row');
	const timeline = document.createElement('input');
	const starttime = document.createElement('input');
	const endtime = document.createElement('input');
	 
		timeline.type= document.querySelector('input[type="time"]');
		starttime.type="number";
		starttime.id="starttime";
		endtime.type="number";
		endtime.id="endtime";
	
	
	const btncontrol=document.createElement('div');
	const cuecontrol=document.createElement('div');	
	const playerwindow=document.createElement('div');	
	
	const mediaplayer=document.createElement('audio');
			
		  
		 mediaplayer.setAttribute('data-setup', '{}');
		 mediaplayer.controls = true;
		 mediaplayer.setAttribute("src", url);
		 mediaplayer.load();
	      
		  
	
		  
	const cueup = [document.getElementById('mediaFiles')]	  
	     cueup.forEach((item, index) => {
         listItem.classList.add("list-group-item");
         listItem.setAttribute("data-index", index);
	     listItem.innerText = file.name;
	     cuecontrol.innerText=file.name;  
	     mediaplayer.setAttribute("src", url);	   
	     mediaplayer.setAttribute('data-index', i + 1);    });	
		 
		timeline.value=endtime.value;
		
		playbtn.addEventListener('click', function() {
         if (mediaplayer.paused || mediaplayer.ended) {
          mediaplayer.play();
          playbtn.textContent = 'Pause';
		  playbtn.style.background='yellow';}
        else {
          mediaplayer.pause();
          playbtn.textContent = 'Play';
		  playbtn.style.background='green';}	});
		
	    loopbtn.addEventListener("click",	() => {		     
	     if (mediaplayer.loop === true) {
		 mediaplayer.loop = false;
		 loopbtn.style.background='lightgray';}
	     else {mediaplayer.loop = true;
		 loopbtn.style.background='blue';}		});
		 
		 stopbtn.addEventListener("click",	() => {
		 mediaplayer.pause();
		 mediaplayer.currentTime=starttime.value;
		 mediaplayer.loop = false;
		 loopbtn.style.background='lightgray';
		 playbtn.textContent = 'Play'		 
		 playbtn.style.background='green';
		 });

    const deletetrack =[document.getElementById('sortableplaylist')]
		deletebtn.addEventListener("click", () => {		
	    medialist.removeChild(trackcontainer);	});
        

		
 

	    mediaplayer.addEventListener('timeupdate', () => {
    const currentTime = mediaplayer.currentTime;
    const duration = mediaplayer.duration;
    const progress = (currentTime);
  
		timeline.value=`${progress}`-`${endtime.value}` ; 	});

		starttime.addEventListener('change',function setStartTime(){
		mediaplayer.currentTime=starttime.value;	});	
	
		endtime.addEventListener('change',function setEndTime(){
		mediaplayer.currentTime = endtime.value; 


	mediaplayer.addEventListener('timeupdate', function() {
		if (mediaplayer.currentTime >= endtime.value) { // set the end time to input
		mediaplayer.pause();
	    mediaplayer.currentTime=starttime.value;
	 
	    playbtn.style.background="green";
	    playbtn.textContent = 'Play';}	
		if (mediaplayer.loop === true){
	    mediaplayer.play()}	  
	  });	
		
		timeline.min=starttime.value;
		timeline.max=endtime.value;
	  
	});
	
	

	medialist.appendChild(trackcontainer);	
	trackcontainer.appendChild(cuecontrol);
	trackcontainer.appendChild(playerwindow);
	playerwindow.appendChild(mediaplayer);
	trackcontainer.appendChild(btncontrol);	
	
	
	
	btncontrol.appendChild(loopbtn);	
	btncontrol.appendChild(playbtn);
	btncontrol.appendChild(stopbtn);
	btncontrol.appendChild(timeline);
	btncontrol.appendChild(deletebtn);
	
	
	
	btncontrol.appendChild(starttime);
	btncontrol.appendChild(endtime);
	
	
	
		trackcontainer.className="row";
		
	    trackcontainer.style.border="2px solid purple";
	    trackcontainer.style.height="10%";
		
		
		cuecontrol.className="col";
		playerwindow.className="col";
		btncontrol.className="col";
		
		cuecontrol.style.width="33%";
		playerwindow.style.width="33%";
		btncontrol.style.width="33%";
		
		
		stopbtn.innerHTML="STOP";
		loopbtn.innerHTML="Loop";
		playbtn.textContent = 'Play';
		cuebtn.innerHTML="ARM";
		deletebtn.innerHTML="Delete";
		
		loopbtn.style.background="lightgray";
		
		playbtn.style.background="green";
		stopbtn.style.background="orange";
		deletebtn.style.background="red";
	

	
	
	
	}
	});
	 
	

	
	
</script



</html>
